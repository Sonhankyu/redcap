(("undefined"!==typeof self?self:this)["webpackJsonpdatamart_vue"]=("undefined"!==typeof self?self:this)["webpackJsonpdatamart_vue"]||[]).push([[3],{"01c7":function(e,t,r){"use strict";var s=r("9077"),n=r.n(s);n.a},"38c1":function(e,t,r){},"437d":function(e,t,r){"use strict";var s=r("e874"),n=r.n(s);n.a},4879:function(e,t,r){},"4f50":function(e,t,r){},"5bde":function(e,t,r){},"628b":function(e,t,r){},"72a5":function(e,t,r){},"7b42":function(e,t,r){},"7d97":function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"page"},[e._m(0),e._m(1),e.revision?r("div",{staticClass:"top-container card mb-4"},[e._m(2),r("div",{staticClass:"card-body py-2 px-3"},[r("section",{staticClass:"buttons"},[r("RevisionSelect"),r("b-button-group",[r("RunRevisionButton",{attrs:{id:"run-revision-button"}}),r("SelectMrnButton",{staticClass:"ml-2",attrs:{id:"select-mrn-button"}})],1)],1),e._l(e.warnings,(function(e,t){return r("InfoPanel",{key:t,attrs:{summary:e.summary,description:e.description,type:e.type}})}))],2)]):e._e(),e.revision&&e.user?r("div",{staticClass:"details-container"},[r("RevisionDetail",{attrs:{revision:e.revision},scopedSlots:e._u([{key:"header",fn:function(){},proxy:!0},{key:"footer",fn:function(){return[r("section",{staticClass:"buttons"},[e.user.isAdmin()&&e.totalRevisions>1?r("DeleteRevisionButton"):e._e(),e.revision.canBeUsedByUserForNewRevision(e.user)?r("CreateRevisionButton"):e._e(),e.user.canApproveRevision(e.revision)?r("ApproveRevisionButton"):e._e()],1)]},proxy:!0}],null,!1,2526346462)})],1):e._e()])},n=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"projhdr mb-2"},[r("i",{staticClass:"fas fa-shopping-cart"}),e._v(" Clinical Data Mart ")])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("p",{staticClass:"mb-2"},[e._v(' Listed below is the current Data Mart configuration for this project. If you have appropriate privileges, you may run the "Fetch clinical data" button to retrieve data from the EHR. When fetching, any existing patients will have new data added to their record in the project. If you have permission to create new revisions of the current Data Mart configuration, you will see a "Request a configuration change" button at the bottom of the page. When submitted, all configuration revisions must be approved by a REDCap administrator before taking effect in the project.'),r("br"),e._v(" If a revision contains a list of Medical Record Numbers, those not yet in the project will be created as new records as soon as the revision is approved. ")])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"card-header"},[r("span",{staticClass:"title"},[e._v("Revision")])])}],a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"alert",class:e._type,attrs:{role:"warning"}},[r("span",{staticClass:"title",domProps:{innerHTML:e._s(e.summary)}}),r("div",{domProps:{innerHTML:e._s(e.description)}})])},i=[],o=(r("dca8"),r("5530")),c=Object.freeze({primary:"alert-primary",secondary:"alert-secondary",success:"alert-success",danger:"alert-danger",warning:"alert-warning",info:"alert-info",light:"alert-light",dark:"alert-dark"}),u={name:"InfoPanel",data:function(){return{types:Object(o["a"])({},c)}},props:{summary:{type:String,default:""},description:{type:String,default:""},type:{type:String,default:""}},computed:{_type:function(){var e=this.types[this.type];return e||this.types.info}}},l=u,d=(r("82b6"),r("2877")),f=Object(d["a"])(l,a,i,!1,null,"578298d8",null),h=f.exports,m=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-dropdown",{staticClass:"m-0",attrs:{id:"revision-selector1",variant:"secondary",disabled:!e.userIsAdmin,"no-caret":!e.userIsAdmin},scopedSlots:e._u([{key:"button-content",fn:function(){return[e.selected&&e.selected.index?r("span",[e._v("Revision "+e._s(e.selected.index))]):e._e()]},proxy:!0}])},[e.userIsAdmin?e._l(e.revisions,(function(t,s){return r("b-dropdown-item-button",{key:s,class:{selected:e.isCurrent(t),approved:t.isApproved()},on:{click:function(r){return e.onSelect(t)}}},[r("section",{staticClass:"info"},[r("span",{staticClass:"badge badge-info mr-1"},[e._v(e._s(t.index))]),r("span",[e._v("Revision date: "+e._s(t.metadata.date))])]),r("RevisionMetadataIcons",{staticClass:"metadata-icons d-inline ml-1",attrs:{revision:t}})],1)})):e._e()],2)],1)},p=[],v=r("5136"),b={name:"RevisionList",components:{RevisionMetadataIcons:v["a"]},computed:{revisions:function(){return this.$store.state.revisions.list},selected:function(){return this.$store.getters["revisions/selected"]},isCurrent:function(){var e=this;return function(t){if(null==e.selected)return!1;try{return e.selected.metadata.id==t.metadata.id}catch(r){return!1}}},buttonText:function(){return this.userIsAdmin&&1!=this.revisions.length?this.selected?"Revision ".concat(this.selected.index):"Select a revision":this.selected?"Revision ".concat(this.selected.index):"no revisions"},userIsAdmin:function(){var e=this.$store.state.user.info;if(!e)return!1;var t=e.super_user,r=void 0!==t&&t;return r}},methods:{onSelect:function(e){var t=e.metadata.id;this.$store.dispatch("revisions/setSelected",t)}}},g=b,_=(r("82c3"),Object(d["a"])(g,m,p,!1,null,"e3a2b3dc",null)),y=_.exports,w=r("2ffe"),x=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-dropdown",{staticClass:"m-0",attrs:{size:"",right:"",variant:"success",disabled:e.disabled},scopedSlots:e._u([{key:"button-content",fn:function(){return[r("font-awesome-icon",{attrs:{icon:["fas","cloud-download-alt"]}}),r("span",{staticClass:"ml-1"},[e._v("Fetch all records "),r("span",{staticClass:"badge badge-light"},[e._v(e._s(e.totalMrns))])])]},proxy:!0}])},[r("b-dropdown-text",{attrs:{id:"fetch-form"}},[r("b-form-checkbox",{staticClass:"small",model:{value:e.background,callback:function(t){e.background=t},expression:"background"}},[r("font-awesome-icon",{attrs:{icon:["fas","cog"]}}),e._v(" Fetch in a background process")],1),r("b-form-checkbox",{staticClass:"small",attrs:{disabled:!e.background},model:{value:e.send_feedback,callback:function(t){e.send_feedback=t},expression:"send_feedback"}},[r("font-awesome-icon",{attrs:{icon:["fas","envelope"]}}),e._v(" Send me a message when completed")],1),r("div",{staticClass:"text-right mt-2"},[r("b-button",{attrs:{variant:"primary",size:"sm"},on:{click:e.onClick}},[r("font-awesome-icon",{attrs:{icon:["fas","check-circle"]}}),r("span",[e._v(" Confirm")])],1)],1)],1)],1),r("b-modal",{ref:"modal-fetch",attrs:{id:"modal-fetch",title:"Fetching Data",size:"md","no-stacking":"","no-close-on-esc":"","no-close-on-backdrop":"","hide-header-close":""},scopedSlots:e._u([{key:"modal-footer",fn:function(t){var s=t.ok;return[r("div",{staticClass:"ml-auto"},[e.loading?r("b-button",{attrs:{variant:"secondary",size:"sm"},on:{click:e.cancelFetch}},[e._v("Cancel")]):r("b-button",{attrs:{variant:"primary",size:"sm"},on:{click:s}},[e._v("Ok")])],1)]}}])},[r("RevisionFetchProgress",{ref:"fetch-progress",attrs:{progress_total:e.totalMrns,progress_value:e.totalProcessed,mrn:e.currentMrn,mrnsData:e.results}})],1)],1)},k=[],C=(r("99af"),r("4fad"),r("d3b7"),r("e6cf"),r("bf19"),r("53ca")),R=(r("96cf"),r("1da1")),P=r("3835"),O=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e.is_processing?r("div",[r("div",[r("p",{staticClass:"time"},[e._v("Elapsed time: "),r("span",{staticClass:"stopwatch"},[e._v(e._s(e.fixed_time)+" ("+e._s(e.readable_time)+")")])]),r("ProgressBar",{ref:"progress_bar",staticClass:"mb-2",attrs:{value:e.progress_value,total:e.progress_total}}),r("p",[r("span",[e._v("Processing "),r("strong",[e._v(e._s(e.mrn))]),e._v(" - "+e._s(e.progress_value+1)+"/"+e._s(e.progress_total)+" ")]),r("i",{staticClass:"fas fa-spinner fa-spin"})])],1)]):r("div",[r("p",{staticClass:"time"},[e._v("The request took "+e._s(e.readable_time)+" ("+e._s(e.fixed_time)+" seconds)")]),r("div",[0==e.overall_stats_count?r("p",[e._v("Data across all patients was already up to date.")]):r("p",{staticClass:"text-center"},[e._v("Here is a summary of the data pulled across all patients:")])])]),r("transition",{attrs:{name:"fade"}},[r("Stats",{attrs:{stats:e.fhir_stats}})],1),r("transition",{attrs:{name:"fade"}},[r("FhirErrors",{staticClass:"errors-container",attrs:{errors:e.fhir_errors}})],1)],1)},$=[],j=(r("4160"),r("a9e3"),r("b680"),r("b64b"),r("25f0"),r("159b"),r("2909")),S=r("c1df"),M=r.n(S),q=r("d4ec"),E=r("bee2"),z=r("ade3"),B=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(q["a"])(this,e),Object(z["a"])(this,"time_start",0),Object(z["a"])(this,"time_end",0),Object(z["a"])(this,"is_running",!1),t&&this.start()}return Object(E["a"])(e,[{key:"start",value:function(){this.is_running||(this.time_start=performance.now(),this.is_running=!0)}},{key:"stop",value:function(){return this.is_running?(this.time_end=performance.now(),this.is_running=!1,this.total):this.total}},{key:"reset",value:function(){this.start=0,this.end=0}},{key:"total",get:function(){if(this.is_running&&this.time_start>0){var e=performance.now()-this.time_start;return e}return this.time_end-this.time_start}}]),e}(),A=B,F=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"progress"},[r("div",{staticClass:"progress-bar",style:{width:e.width+"%"},attrs:{role:"progressbar","aria-valuenow":e.width,"aria-valuemin":0,"aria-valuemax":e.total}})])},I=[],T={name:"ProgressBar",props:{total:{type:Number,default:0},value:{type:Number,default:0},color:{type:String,default:"green"}},computed:{width:function(){return this.total<=0?0:100/this.total*this.value}}},D=T,Q=Object(d["a"])(D,F,I,!1,null,null,null),N=Q.exports,L=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.total>0?r("div",{staticClass:"stats text-left"},[e.stats?r("table",{staticClass:"table table-bordered table-hover table-striped table-sm"},[e._m(0),r("transition-group",{attrs:{name:"list",tag:"tbody"}},e._l(e.animated_stats,(function(t,s){return r("tr",{key:"row-"+s,class:"resource-"+s,attrs:{scope:"col"}},[r("th",{attrs:{scope:"row"}},[e._v(e._s(s))]),r("td",{staticClass:"text-right count"},[e._v(e._s(t))])])})),0)],1):e._e()]):r("div")},H=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("thead",{staticClass:"thead-light"},[r("tr",[r("th",{attrs:{scope:"col"}},[e._v("Data category")]),r("th",{staticClass:"text-right",attrs:{scope:"col"}},[e._v("Total")])])])}],V=(r("cca6"),r("1209")),W={data:function(){return{animated_stats:{}}},props:{stats:{type:Object,default:function(){return{}}}},watch:{total:function(e,t){var r=this,s=function(e){isNaN(r.animated_stats[e])&&r.$set(r.animated_stats,e,0);var t=Object.assign({},r.animated_stats),s={targets:t,round:1,easing:"linear",update:function(){r.$set(r.animated_stats,e,t[e])},begin:function(t){var r=document.querySelector("tr.resource-".concat(e," .count"));r&&r.classList.add("animated")},complete:function(t){var r=document.querySelector("tr.resource-".concat(e," .count"));r&&r.classList.remove("animated")}},n=t[e],a=r.stats[e];if(n==a)return"continue";s[e]=a,Object(V["a"])(s)};for(var n in this.stats)s(n)}},computed:{total:function(){for(var e=0,t=0,r=Object.entries(this.stats);t<r.length;t++){var s=Object(P["a"])(r[t],2),n=(s[0],s[1]);e+=n}return e}},methods:{}},J=W,U=(r("d60c"),Object(d["a"])(J,L,H,!1,null,"25a389bc",null)),Y=U.exports,K=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.has_errors?r("div",{staticClass:"errors"},[r("p",[e._v("Warning - the following errors occurred:")]),r("b-table",{staticClass:"my-2",attrs:{id:"errors-table",items:e.errors,fields:e.fields,"per-page":e.perPage,"current-page":e.currentPage,small:"",bordered:"",striped:"",hover:""},scopedSlots:e._u([{key:"cell(error)",fn:function(t){return[r("section",{},[r("span",[e._v(e._s(t.value.message))]),t.value.detail?r("p",[e._v(e._s(t.value.detail.message)+" "),r("span",[e._v("("+e._s(e.error.detail.code)+")")])]):e._e()])]}}],null,!1,2308726468)}),e.has_errors?r("b-pagination",{staticClass:"ml-0",attrs:{"total-rows":e.total,"per-page":e.perPage,"aria-controls":"errors-table",size:"sm"},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}}):e._e()],1):r("div")},G=[],X={name:"FhirErrors",data:function(){return{currentPage:1,perPage:10,fields:["mrn","error"]}},props:{errors:{type:Array,default:function(){return[]}}},computed:{has_errors:function(){return this.errors.length>0},total:function(){return this.errors.length}},methods:{}},Z=X,ee=Object(d["a"])(Z,K,G,!1,null,"ee0c55ca",null),te=ee.exports,re={name:"",components:{ProgressBar:N,Stats:Y,FhirErrors:te},data:function(){return{stopwatch:new A(!1),time:0,stopwatch_interval:null,fhir_errors:[],fhir_stats:{},overall_stats_count:0}},destroyed:function(){this.clearInterval()},mounted:function(){this.fhir_errors=[],this.startWatch()},props:{progress_value:{type:Number,default:0},progress_total:{type:Number,default:0},mrn:{type:String,default:""},mrnsData:{type:Array,default:function(){return[]}}},computed:{is_processing:function(){return this.progress_value<this.progress_total},fixed_time:function(){var e=this.time/1e3;return e.toFixed(2)},readable_time:function(){this.time;return M.a.duration(this.time,"milliseconds").humanize()},has_errors:function(){return Object.keys(this.fhir_errors).length>0}},watch:{progress_value:function(e){e>=this.progress_total&&this.stopWatch()},mrnsData:{immediate:!0,deep:!0,handler:function(e){if(!(e.length<1)){var t=Object(j["a"])(e).pop(),r=t.mrn,s=t.data;r&&this.addResults(r,s)}}}},methods:{startWatch:function(){var e=this;this.stopwatch.start(),this.stopwatch_interval=setInterval((function(){e.time=e.stopwatch.total}),10)},stopWatch:function(){this.stopwatch.stop(),clearInterval()},clearInterval:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){this.stopwatch_interval&&clearInterval(this.stopwatch_interval)})),addResults:function(e,t){for(var r=this,s=t.errors,n=void 0===s?[]:s,a=t.metadata.stats,i=void 0===a?[]:a,o=0,c=Object.entries(i);o<c.length;o++){var u=Object(P["a"])(c[o],2),l=u[0],d=u[1];this.overall_stats_count+=d;var f=this.fhir_stats[l]||0;this.$set(this.fhir_stats,l,d+f)}n.forEach((function(t){r.fhir_errors.push({mrn:e,error:t})}))}}},se=re,ne=(r("f578"),Object(d["a"])(se,O,$,!1,null,"00e29106",null)),ae=ne.exports,ie={promise:null,abort:!1,send_feedback:!1,background:!1,totalProcessed:0,results:[]},oe={components:{RevisionFetchProgress:ae},data:function(){return Object(o["a"])({},ie,{loading:!1,next_mrn:null,currentMrn:null,abort:!1})},computed:{title:function(){var e=this.totalMrns,t=1===e?"":"s";return e<1?"Data can not be fetched":"Fetch data for ".concat(e," record").concat(t)},revision:function(){return this.$store.getters["revisions/selected"]},totalMrns:function(){return this.revision.getTotalFetchableMrns()},disabled:function(){try{if(!this.revision)return!0;var e=this.$store.getters["revisions/isActive"](this.revision),t=this.$store.state.user.info;return!e||!t.hasValidToken()||this.totalMrns<1}catch(r){return!0}}},methods:{showProgress:function(){var e=this.$refs["modal-fetch"];return e.show()},resetData:function(){for(var e=0,t=Object.entries(ie);e<t.length;e++){var r=Object(P["a"])(t[e],2),s=r[0],n=r[1];this[s]=n}},wait:function(e){return new Promise((function(t){return setTimeout(t,e)}))},cancelFetch:function(){this.abort=!0;var e=this.promise.cancelToken;e&&e.cancel("operation canceled by user"),this.$refs["modal-fetch"].hide()},onClick:function(e){var t=this;return Object(R["a"])(regeneratorRuntime.mark((function e(){var r,s,n,a,i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.background){e.next=18;break}return e.prev=1,r=null,s={background:t.background,send_feedback:t.send_feedback},n=t.revision.metadata.id,e.next=7,t.$API.runRevision(n,r,s);case 7:a=e.sent,i=a.data,o=i.message,t.$bvModal.msgBoxOk(o,{title:"Success",size:"md",buttonSize:"sm",headerClass:"font-weight-bold",bodyClass:"text-break",okVariant:"secondary"}),e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](1),t.showErrorModal(e.t0);case 16:e.next=19;break;case 18:t.fetchData();case 19:case"end":return e.stop()}}),e,null,[[1,13]])})))()},fetchData:function(){var e=this;return Object(R["a"])(regeneratorRuntime.mark((function t(){var r,s,n,a,i,o,c,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:t.prev=0,e.resetData(),e.loading=!0,r=e.revision.metadata.id,e.next_mrn=null,e.showProgress();case 6:if(!e.abort){t.next=8;break}return t.abrupt("break",22);case 8:return s=e.next_mrn,e.currentMrn=s,n={background:e.background,send_feedback:e.send_feedback},e.promise=e.$API.runRevision(r,s,n),t.next=14,e.promise;case 14:if(a=t.sent,i=a.data,o=void 0===i?{}:i,"object"===Object(C["a"])(o)){t.next=18;break}throw new Error("Malformed data received: '".concat(String(o),"'"));case 18:c=o.metadata,u=void 0===c?{}:c,e.next_mrn=u.next_mrn,s&&(e.results.push({mrn:s,data:o}),e.totalProcessed++);case 21:if(e.next_mrn&&!e.abort){t.next=6;break}case 22:t.next=29;break;case 24:t.prev=24,t.t0=t["catch"](0),console.log(t.t0),e.cancelFetch(),e.showErrorModal(t.t0);case 29:return t.prev=29,e.reloadRevisions(),e.loading=!1,t.finish(29);case 33:case"end":return t.stop()}}),t,null,[[0,24,29,33]])})))()},showErrorModal:function(e){var t,r="Unexpected error",s=r;if("response"in e){var n=e.response.data;"message"in n&&(s=n.message)}else if("toJSON"in e){var a=e.toJSON(),i=a.message;i&&(s=i)}s=null!==(t=s)&&void 0!==t?t:r,this.$bvModal.msgBoxOk(s,{title:"Error",size:"md",buttonSize:"sm",headerClass:"font-weight-bold",bodyClass:"text-break",okVariant:"secondary"})},reloadRevisions:function(){var e=this;return Object(R["a"])(regeneratorRuntime.mark((function t(){var r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$API.getRevisions();case 3:r=t.sent,s=r.data,e.$store.dispatch("revisions/setList",s),e.$store.dispatch("revisions/selectMostRecentRevision"),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),e.$swal.fire({icon:"error",title:"error reloading the revisions",html:t.t0});case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},prompt:function(e){var t=this;return Object(R["a"])(regeneratorRuntime.mark((function r(){var s,n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return s={title:"Please Confirm"},n="You are about to start the adjudication process.\n      Please be aware that your existing data could be overwritten in the process according to your mapping 'preselect' configuration.",r.next=4,t.$bvModal.msgBoxConfirm(n,s);case 4:a=r.sent,a&&"function"===typeof e&&e();case 6:case"end":return r.stop()}}),r)})))()}}},ce=oe,ue=(r("d997"),Object(d["a"])(ce,x,k,!1,null,"5c4e825b",null)),le=ue.exports,de=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle.sidebar-search",modifiers:{"sidebar-search":!0}}],attrs:{variant:"info"}},[r("font-awesome-icon",{attrs:{icon:["fas","search"]}}),r("span",{staticClass:"ml-1"},[e._v("Select and fetch records...")])],1),r("b-sidebar",{attrs:{id:"sidebar-search",title:"Search MRN",right:"",shadow:"",lazy:"",width:"500px"}},[r("div",{staticClass:"px-3 py-2"},[r("p",[e._v("Search a fetchable MRN available in the project and fetch its data individually")]),r("SearchMrns")],1)])],1)},fe=[],he=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("b-form-group",{staticClass:"mb-2 ml-auto",attrs:{"label-for":"filter-input","label-cols-sm":"0","label-align-sm":"left","label-size":"sm"}},[r("b-input-group",{attrs:{size:"sm"}},[r("b-form-input",{attrs:{id:"filter-input",type:"search",placeholder:"Type to Search",debounce:"300"},model:{value:e.queryProxy,callback:function(t){e.queryProxy=t},expression:"queryProxy"}}),r("b-input-group-append",[r("b-button",{attrs:{disabled:!e.queryProxy},on:{click:e.resetQuery}},[e._v("Clear")])],1)],1)],1),r("section",[e.hasItems?r("section",{staticClass:"d-flex align-items-center"},[r("b-pagination",{staticClass:"my-auto",attrs:{"total-rows":e.total,"per-page":e.perPage,"aria-controls":"my-table",size:"sm"},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}}),r("b-dropdown",{staticClass:"ml-auto",attrs:{text:"Results per page",size:"sm"},scopedSlots:e._u([{key:"button-content",fn:function(){return[r("span",[e._v("Results per page: "+e._s(e.perPage))])]},proxy:!0}],null,!1,1561094034)},[e._l(e.resultsPerPageOptions,(function(t,s){return[r("b-dropdown-item",{key:"per-page-"+s+"-"+t,attrs:{active:t==e.perPage},on:{click:function(r){return e.setPerPage(t)}}},[e._v(e._s(t))])]}))],2)],1):e._e(),r("b-table",{staticClass:"my-2",attrs:{id:"my-table",items:e.items,fields:e.fields,small:"",bordered:"",striped:"",hover:"","empty-text":"nothing to show","show-empty":!0},scopedSlots:e._u([{key:"head(select)",fn:function(t){return[r("div",{staticClass:"d-flex"},[r("b-form-checkbox",{attrs:{indeterminate:e.indeterminate,disabled:0==e.total,switch:""},on:{change:e.toggleAll},model:{value:e.allSelected,callback:function(t){e.allSelected=t},expression:"allSelected"}},[r("span",[e._v(e._s(t.label))])])],1)]}},{key:"cell(select)",fn:function(t){return[r("div",{staticClass:"select-wrapper"},[r("b-form-checkbox",{attrs:{value:t.item["mrn"],switch:"",size:"lg"},model:{value:e.queue,callback:function(t){e.queue=t},expression:"queue"}})],1)]}},{key:"cell(mrn)",fn:function(t){return[r("section",{staticClass:"d-flex justify-content-between mrn"},[r("span",[e._v(e._s(t.value))])])]}}])})],1),r("section",{staticClass:"mt-2"},[r("b-button",{attrs:{size:"sm",variant:"danger",disabled:0==e.totalToFetch},on:{click:e.clearQueue}},[r("font-awesome-icon",{attrs:{icon:["fas","trash"],"fixed-width":""}}),r("span",{staticClass:"ml-2"},[e._v("clear queue")])],1),r("b-button",{staticClass:"ml-2",attrs:{size:"sm",variant:"success",disabled:e.disabled},on:{click:e.fetchQueue}},[r("font-awesome-icon",{attrs:{icon:["fas","cloud-download-alt"],"fixed-width":""}}),r("span",{staticClass:"ml-2"},[e._v("fetch data")])],1),r("span",{staticClass:"ml-2 text-muted"},[e._v("Total MRNs: "),r("b",[e._v(e._s(this.queue.length))])]),r("div",{staticClass:"queue-container"},[r("b-table",{staticClass:"my-2",attrs:{id:"queue-table",fields:["mrn"],items:e.queueItems,small:"",bordered:"",striped:"",hover:"","empty-text":"nothing to show","show-empty":!0},scopedSlots:e._u([{key:"cell(mrn)",fn:function(t){return[r("section",{staticClass:"d-flex justify-content-between mrn"},[r("span",[e._v(e._s(t.value))]),r("b-button",{attrs:{size:"sm",variant:"danger"},on:{click:function(r){return e.removeFromQueue(t.value)}}},[r("font-awesome-icon",{attrs:{icon:["fas","trash"],"fixed-width":""}})],1)],1)]}}])})],1)],1),r("b-modal",{ref:"modal-fetch",attrs:{id:"modal-fetch",title:"Fetching Data",size:"md","no-stacking":"","no-close-on-esc":"","no-close-on-backdrop":"","hide-header-close":""},scopedSlots:e._u([{key:"modal-footer",fn:function(t){var s=t.ok;return[r("div",{staticClass:"ml-auto"},[e.loading?r("b-button",{attrs:{variant:"secondary",size:"sm"},on:{click:e.cancelFetch}},[e._v("Cancel")]):r("b-button",{attrs:{variant:"primary",size:"sm"},on:{click:s}},[e._v("Ok")])],1)]}}])},[r("RevisionFetchProgress",{ref:"fetch-progress",attrs:{progress_total:e.totalToFetch,progress_value:e.totalProcessed,mrn:e.currentMrn,mrnsData:e.results}})],1)],1)},me=[],pe=(r("a623"),r("c975"),r("d81d"),r("a434"),r("498a"),r("b85c")),ve=[10,25,50,100],be={components:{RevisionFetchProgress:ae},data:function(){return{currentMrn:"",searching:!1,loading:!1,minimumQueryLength:1,query:"",perPage:ve[0],currentPage:1,items:[],total:0,fields:["mrn","select"],totalProcessed:0,results:[],queue:[],maxQueueSize:10,resultsPerPageOptions:ve}},computed:{queryProxy:{get:function(){return this.query},set:function(e){if(""==e)return this.resetQuery();this.query=e,this.submitQuery()}},allSelected:{get:function(){var e=this;if(0==this.items.length)return!1;var t=this.items.every((function(t){var r=t.mrn;return e.queue.indexOf(r)>=0}));return t},set:function(e){}},indeterminate:{get:function(){var e=this;return 0!=this.queue.length&&(!this.items.every((function(t){var r=t.mrn;return e.queue.indexOf(r)<0}))&&!this.allSelected)},set:function(e){}},totalToFetch:function(){return this.queue.length},hasItems:function(){return this.items.length>0},searchDisabled:function(){return this.searching||String(this.query).trim().length<this.minimumQueryLength},revision:function(){return this.$store.getters["revisions/selected"]},disabled:function(){try{if(!this.revision)return!0;if(this.queue.length<1)return!0;var e=this.$store.getters["revisions/isActive"](this.revision),t=this.$store.state.user.info;return!e||!t.hasValidToken()}catch(r){return!0}},queueItems:function(){return this.queue.map((function(e){return{mrn:e}}))}},methods:{setPerPage:function(e){this.perPage=e},notify:function(e,t){this.$bvToast.toast(t,{title:"Search results",autoHideDelay:1e3,appendToast:!0})},searchMrns:function(){var e=this;return Object(R["a"])(regeneratorRuntime.mark((function t(){var r,s,n,a,i,o,c,u,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=String(e.query),!(r.trim().length<e.minimumQueryLength)){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,e.searching=!0,s=(e.currentPage-1)*e.perPage,n=e.perPage,t.next=9,e.$API.searchMrns({query:r,start:s,limit:n});case 9:a=t.sent,i=a.data,i=void 0===i?{}:i,o=i.list,c=void 0===o?[]:o,u=i.total,l=void 0===u?0:u,e.total=l,e.items=Object(j["a"])(c),t.next=20;break;case 17:t.prev=17,t.t0=t["catch"](3),console.log(t.t0);case 20:return t.prev=20,e.searching=!1,t.finish(20);case 23:case"end":return t.stop()}}),t,null,[[3,17,20,23]])})))()},submitQuery:function(){var e=this;return Object(R["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.currentPage=1,t.next=3,e.searchMrns();case 3:r="Search results",0===e.total?e.notify(r,"No results for '".concat(e.query,"'")):e.notify(r,"".concat(e.total," match").concat(1===e.total?"":"es"," found"));case 5:case"end":return t.stop()}}),t)})))()},resetQuery:function(){this.total=0,this.query="",this.items=[]},fetchQueue:function(){var e=this;return Object(R["a"])(regeneratorRuntime.mark((function t(){var r,s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.results=[],e.loading=!0,e.totalProcessed=0,r=Object(pe["a"])(e.queue),t.prev=4,r.s();case 6:if((s=r.n()).done){t.next=12;break}return n=s.value,t.next=10,e.fetchMrn(n);case 10:t.next=6;break;case 12:t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](4),r.e(t.t0);case 17:return t.prev=17,r.f(),t.finish(17);case 20:e.loading=!1,e.currentMrn="";case 22:case"end":return t.stop()}}),t,null,[[4,14,17,20]])})))()},fetchMrn:function(e){var t=this;return Object(R["a"])(regeneratorRuntime.mark((function r(){var s,n,a,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,s=t.$refs["modal-fetch"],s.show(),t.currentMrn=e,n=t.revision.metadata.id,t.promise=t.$API.runRevision(n,e),r.next=8,t.promise;case 8:if(a=r.sent,i=a.data,o=void 0===i?{}:i,"object"===Object(C["a"])(o)){r.next=12;break}throw new Error("Malformed data received: '".concat(String(o),"'"));case 12:t.results.push({mrn:e,data:o}),t.totalProcessed++,r.next=21;break;case 16:r.prev=16,r.t0=r["catch"](0),console.log(r.t0),t.cancelFetch(),t.showErrorModal(r.t0);case 21:case"end":return r.stop()}}),r,null,[[0,16]])})))()},cancelFetch:function(){var e=this.promise.cancelToken;e&&e.cancel("operation canceled by user"),this.$refs["modal-fetch"].hide()},showErrorModal:function(e){var t=e.responseText,r=e.message,s=void 0===r?"Error fetching data":r,n=t||s;this.$bvModal.msgBoxOk(n,{title:"Error",size:"md",buttonSize:"sm",headerClass:"font-weight-bold",bodyClass:"text-break",okVariant:"secondary"})},addToQueue:function(e){this.queue.indexOf(e)>=0||(this.queue.length>=this.maxQueueSize?this.notify("Max queue size reached","A maximum of ".concat(this.maxQueueSize," values can be selected.")):this.queue.push(e))},removeFromQueue:function(e){var t=this.queue.indexOf(e);t<0||this.queue.splice(t,1)},clearQueue:function(){this.queue=[]},queueExists:function(e){return this.queue.indexOf(e)>=0},toggleAll:function(e){var t=this,r=Object(j["a"])(this.items);e?r.forEach((function(e){var r=e.mrn,s=t.queue.indexOf(r);s>=0||t.queue.push(r)})):r.forEach((function(e){var r=e.mrn,s=t.queue.indexOf(r);s<0||t.queue.splice(s,1)}))}},watch:{currentPage:{immediate:!0,handler:function(){this.searchMrns()}},perPage:{immediate:!0,handler:function(e,t){e!=t&&this.searchMrns()}}}},ge=be,_e=(r("b8d1"),Object(d["a"])(ge,he,me,!1,null,"68d0b3bf",null)),ye=_e.exports,we={components:{SearchMrns:ye},data:function(){return{}},computed:{},methods:{}},xe=we,ke=(r("01c7"),Object(d["a"])(xe,de,fe,!1,null,"237bc814",null)),Ce=ke.exports,Re=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("button",{staticClass:"btn btn-sm btn-success",on:{click:e.onClick}},[r("i",{staticClass:"far fa-check-circle"}),e._v(" Approve")])},Pe=[],Oe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.errors.length>0?r("div",{staticClass:"json-error"},[e.error?r("div",[r("p",{staticClass:"error-title",domProps:{innerHTML:e._s(e.error.title)}}),r("p",{staticClass:"error-detail",domProps:{innerHTML:e._s(e.error.detail)}})]):r("ul",e._l(e.errors,(function(t,s){return r("li",{key:s},[r("p",{staticClass:"error-title",domProps:{innerHTML:e._s(t.title)}}),r("p",{staticClass:"error-detail",domProps:{innerHTML:e._s(t.detail)}})])})),0)]):e._e()},$e=[],je={name:"JsonError",props:{errors:{type:Array,default:function(){return[]}}},computed:{error:function(){return 1===this.errors.length&&this.errors[0]}}},Se=je,Me=(r("c49f"),Object(d["a"])(Se,Oe,$e,!1,null,"097f77f5",null)),qe=Me.exports,Ee={name:"ApproveButton",methods:{onClick:function(){var e=this;return Object(R["a"])(regeneratorRuntime.mark((function t(){var r,s,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,r=e.$store.getters["revisions/selected"].metadata.id,e.$swal.fire({icon:"info",title:"approving",html:'<p class="text-center"><i class="fas fa-spinner fa-spin"></i> Please wait.</p>',allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1}),t.next=5,e.$store.dispatch("revisions/approve",r);case 5:t.sent,e.$swal.fire({toast:!0,showConfirmButton:!1,timer:3e3,position:"top-end",icon:"success",title:"Success",text:"The revision has been approved!"}),t.next=16;break;case 9:t.prev=9,t.t0=t["catch"](0),s=t.t0.responseText,n=JSON.parse(s),a=n.errors,e.$swal.fire({icon:"error",title:"error approving the revision"}),e.$swal.addVueComponent(qe,{propsData:{errors:a}});case 16:case"end":return t.stop()}}),t,null,[[0,9]])})))()}}},ze=Ee,Be=Object(d["a"])(ze,Re,Pe,!1,null,"777fdaa9",null),Ae=Be.exports,Fe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("button",{staticClass:"btn btn-sm btn-info",on:{click:e.onClick}},[r("i",{staticClass:"fas fa-file-export"}),e._v(" Request a configuration change")])},Ie=[],Te={name:"CreateRevisionButton",methods:{onClick:function(){var e=this;return Object(R["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$store.dispatch("revision/setAllowedSettings",{mrns:!1}),e.$store.dispatch("revision/reset"),e.$router.push({name:"create-revision"});case 3:case"end":return t.stop()}}),t)})))()}}},De=Te,Qe=(r("437d"),Object(d["a"])(De,Fe,Ie,!1,null,"74e9fc5e",null)),Ne=Qe.exports,Le=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("StyledButton",{attrs:{type:"danger",text:"Delete Revision",icon:"fas fa-trash-alt"},on:{click:e.onClick}})},He=[],Ve=r("0342"),We={name:"DeleteButton",components:{StyledButton:Ve["a"]},methods:{onClick:function(){var e=this;return Object(R["a"])(regeneratorRuntime.mark((function t(){var r,s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$swal.fire({icon:"warning",title:"Are you sure?",text:"you won't be able to revert this!",showCancelButton:!0,confirmButtonText:"Yes, delete it!"});case 2:if(r=t.sent,!0!==r.value){t.next=16;break}return s=e.$store.getters["revisions/selected"],n=s.metadata.id,t.prev=6,t.next=9,e.$store.dispatch("revisions/delete",n);case 9:t.sent,e.$swal.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,icon:"success",title:"revision deleted",text:""}),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](6),e.$swal.fire({icon:"error",showConfirmButton:!0,timer:3e3,title:"error deleting the revision",text:""});case 16:case"end":return t.stop()}}),t,null,[[6,13]])})))()}}},Je=We,Ue=Object(d["a"])(Je,Le,He,!1,null,"178d6b63",null),Ye=Ue.exports,Ke={name:"HomeView",data:function(){return{test:""}},components:{RevisionSelect:y,RevisionDetail:w["a"],RunRevisionButton:le,SelectMrnButton:Ce,ApproveRevisionButton:Ae,CreateRevisionButton:Ne,DeleteRevisionButton:Ye,InfoPanel:h},computed:{revision:function(){return this.$store.getters["revisions/selected"]},user:function(){return this.$store.state.user.info},totalRevisions:function(){return this.$store.getters["revisions/total"]},warnings:function(){return this.$store.dispatch("warnings/checkAll"),this.$store.state.warnings.list}}},Ge=Ke,Xe=(r("9278"),Object(d["a"])(Ge,s,n,!1,null,"36311e4a",null));t["default"]=Xe.exports},"82b6":function(e,t,r){"use strict";var s=r("38c1"),n=r.n(s);n.a},"82c3":function(e,t,r){"use strict";var s=r("5bde"),n=r.n(s);n.a},8400:function(e,t,r){},9077:function(e,t,r){},9278:function(e,t,r){"use strict";var s=r("7b42"),n=r.n(s);n.a},b8d1:function(e,t,r){"use strict";var s=r("628b"),n=r.n(s);n.a},c49f:function(e,t,r){"use strict";var s=r("4879"),n=r.n(s);n.a},d60c:function(e,t,r){"use strict";var s=r("4f50"),n=r.n(s);n.a},d997:function(e,t,r){"use strict";var s=r("8400"),n=r.n(s);n.a},e874:function(e,t,r){},f578:function(e,t,r){"use strict";var s=r("72a5"),n=r.n(s);n.a}}]);
//# sourceMappingURL=datamart_vue.umd.min.3.js.map